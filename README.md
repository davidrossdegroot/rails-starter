# Rails Starter Template

A production-ready Rails 8 application template with opinionated defaults for rapid development and deployment.

## Features

### Tech Stack
- **Rails 8.1** with modern defaults
- **SQLite3** for all environments (dev/test/prod)
- **Tailwind CSS 4.3** for styling
- **Hotwire** (Turbo + Stimulus) for interactivity
- **Solid Queue/Cache/Cable** for background jobs, caching, and WebSockets

### Development Tools
- **RSpec** with FactoryBot, Capybara, and Shoulda Matchers
- **RuboCop Rails Omakase** for linting
- **Brakeman** for security scanning
- **dotenv** for environment variable management

### Deployment
- **Kamal 2** for containerized deployment
- **Docker** with optimized multi-stage builds
- **nginx** reverse proxy with SSL termination
- **Resend** for transactional email delivery
- Pre-configured for Hetzner VPS deployment

## Quick Start

### Create a New App

```bash
rails new my_app \
  -d sqlite3 \
  -m https://raw.githubusercontent.com/davidrossdegroot/rails-starter/main/template.rb
```

During setup, you'll be prompted for:
- **App name** (e.g., `my_blog`)
- **Docker Hub username**
- **Port number** (e.g., `3000`, `3001`, `3002` - each app needs a unique port)
- **Primary domain** (e.g., `myblog.com`)

### Post-Setup Steps

1. **Configure secrets:**
   ```bash
   cp .env.example .env
   # Edit .env with your actual values
   ```

2. **Set up database:**
   ```bash
   bin/rails db:setup
   ```

3. **Start development server:**
   ```bash
   bin/dev
   ```

4. **Run tests:**
   ```bash
   rspec
   ```

5. **For deployment, see [DEPLOYMENT.md](DEPLOYMENT.md)** for comprehensive instructions.

## What Gets Configured

### Gems Added
- Authentication: `bcrypt`
- Styling: `tailwindcss-rails`
- HTTP client: `httparty`
- Background jobs: `solid_queue`
- Caching: `solid_cache`
- WebSockets: `solid_cable`
- Deployment: `kamal`, `thruster`
- Testing: `rspec-rails`, `factory_bot_rails`, `capybara`, `selenium-webdriver`, `shoulda-matchers`
- Code quality: `rubocop-rails-omakase`, `brakeman`

### Files Copied
- `.rubocop.yml` - RuboCop configuration
- `.ruby-version` - Ruby 4.0.1
- `Dockerfile` - Optimized for production with SQLite3
- `config/deploy.yml` - Kamal deployment configuration
- `.kamal/hooks/pre-deploy` - Automatic container cleanup
- `config/nginx-{app_name}.conf` - nginx reverse proxy template
- `.env.example` - Environment variable template

### Email Configuration
- Configured Resend SMTP in development and production
- Uses `RESEND_EMAIL_API_KEY` from environment
- Domain automatically set based on your input

### Database
- SQLite3 for all environments
- Production database stored in `/var/lib/{app_name}` on server
- Automatic migrations on deploy

## Architecture Decisions

### Why SQLite for Production?
- **Simplicity**: No separate database server to manage
- **Performance**: Fast for read-heavy workloads
- **Cost**: No database hosting costs
- **Reliability**: Perfect for low-to-medium traffic applications
- **Backup**: Simple file-based backups

For high-traffic or write-heavy apps, you can easily switch to PostgreSQL later.

### Why No Kamal-Proxy?
This template assumes deployment to a **shared server** with multiple applications. nginx is already handling SSL termination and routing for all apps, so kamal-proxy would conflict with the existing setup.

**Trade-off**: No zero-downtime deployments, but the pre-deploy hook minimizes downtime to ~30-60 seconds.

## Project Structure

```
my_app/
├── config/
│   ├── deploy.yml              # Kamal configuration (app-specific)
│   └── nginx-{app_name}.conf   # nginx template (copy to server)
├── .kamal/
│   └── hooks/
│       └── pre-deploy          # Auto-cleanup old containers
├── Dockerfile                   # Production container
├── .env.example                 # Environment variable template
├── .rubocop.yml                 # Linting rules
├── spec/                        # RSpec tests
└── CLAUDE.md                    # AI assistant context
```

## Environment Variables

Required variables (set in `.env` and `.kamal/secrets`):

```bash
RAILS_MASTER_KEY=xxx           # Generated by Rails
KAMAL_REGISTRY_PASSWORD=xxx    # Docker Hub token
RESEND_EMAIL_API_KEY=xxx       # Resend API key
```

## Deployment

See [DEPLOYMENT.md](DEPLOYMENT.md) for step-by-step deployment instructions covering:
- Domain setup and DNS configuration
- SSL certificate generation
- nginx configuration
- Port allocation
- Initial deployment
- Ongoing deployments

## Contributing

This is a personal template, but feel free to fork and customize for your needs.

## License

MIT
